<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <title>Stop copying me</title>
    <!-- https://www.flaticon.com/free-icon/line_15654932 -->
    <link rel="shortcut icon" href="img/favicon.png" />
    <link href="css/classless.css" rel="stylesheet">
    <link href="css/common.css" rel="stylesheet" />
    <link href="css/pdfprint.css" rel="stylesheet" />
    <link href="extdeps/deps.css" rel="stylesheet">

  <style>
  </style>

</head>

<body class="impress-not-supported">
<div class="fallback-message">
    <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
    <p>For the best experience please use the latest <b>Firefox</b> browser. <small>Chrome probably works too</small></p>
</div>

<div id="impress-toolbar"></div>

<div id="impress"
    data-transition-duration="0"
    data-width="2020"
    data-height="1200"
    data-max-scale="3"
    data-min-scale="0">

<!-- Slide1 defines canvas position start with data-(x,y). Slide2 needs to
  define data-rel-(x,y) to tell impress.js the default relative movement.
  Successive slides don't need to define any (x,y), unless we need to
  override the position of a slide -->
<div class="step slide" id="fx" data-x="0" data-y="1920">
  <h1><img src="img/favicon.png" />Stopy copying me!</h1>
  <h2>Echo</h2>
  <h3>Echo</h3>
  <h4>Echo</h4>
  <h5>Echo</h5>

  <hr/>

  <div class="bottom-badge">
    <img width="25%" src="img/qr.png"/>
    <p><a href="https://nicolasbrailo.github.io/">https://nicolasbrailo.github.io/</a></p>
    <p class="fineprint">(PSA: Careful when scanning untrusted QR codes!)</p>
  </div>
</div>

<div class="step slide" id="warning" data-rel-y="3840">
  <div class="bottom-badge">
    <img width="25%" src="img/qr.png"/>
    <p><a href="https://nicolasbrailo.github.io/">https://nicolasbrailo.github.io/</a></p>
    <p class="fineprint">(PSA: Careful when scanning untrusted QR codes!)</p>
  </div>
</div>


<div class="step slide" id="stopCopyingMe">
  <h2>Stopy copying me</h2>
  <details>
    <summary>Echo explorer</summary>
    <ul>
      <li></li>
    </ul>
  </details>
  <button id="stopCopyingMe_demoToggle">Start</button>
  <label>Delay <span id="stopCopyingMe_delayValue"></span>
    <input type="range" id="stopCopyingMe_delay" min="0" max="1000" value="0"></label>
  <label>Attenuation <span id="stopCopyingMe_attnValue"></span>
    <input type="range" id="stopCopyingMe_attn" min="0" max="40" step="3" value="0"></label>
  <canvas id="stopCopyingMe_inputTd"></canvas>
  <canvas id="stopCopyingMe_outputTd"></canvas>
</div>

<div class="step slide" id="noAEC">
  <button id="noAEC_rec">Mic enable</button>
  <button id="noAEC_play" disabled>Play</button>
  <button id="noAEC_debugRec">Debug tracks</button>
  <select id="noAEC_mode">
    <!--
      Notes
      - Passthrough: easier to see natural attenuation
      - Half duplex: play with the sliders to see how hard it is to find a good setting. Play with different voices to see how hard it is to find
        a GLOBAL setting. Also, the quality of communication is horrible.
      - Timealigned substract, the reverb/comb effect is greatly reduced (not entirely, as the time alignment isn't perfect)
        but it does very little for the echo: the room coloration means the two signals are different enough that substracting them
        does little to remove the echo, plus it's hard to get the attenuation right (we end up just changing the phase slightly)
      - Room impulse response:
        - Measuring RIR is disruptive
        - Note how the IR lenght needs to be longer than the echo tail, otherwise results are garbage
        - If the IR changes (people move around) then the IR needs to be recalculated
        - Playing with the echo attenuation let's us over/under attenuate, as the RIR isn't entirely precise
    -->
    <option value="passthrough">Passthrough</option>
    <option value="silenceMic">Silence mic</option>
    <option value="testTone">Test Tone</option>
    <option value="halfDuplex">Half Duplex</option>
    <option value="naiveSubtract">Naive Subtract</option>
    <option value="timeAlignedSubtract">Time Aligned Subtract</option>
    <option value="rir">Room impulse response based</option>
    <option value="lms">LMS</option>
  </select>
  <details>
    <summary>Half duplex config</summary>
    <label>Attack <input type="range" id="noAEC_attackMs" min="1" max="100"> <span id="noAEC_attackMs_val"></span>ms</label>
    <label>Decay <input type="range" id="noAEC_decayMs" min="10" max="1000"> <span id="noAEC_decayMs_val"></span>ms</label>
    <label>Threshold <input type="range" id="noAEC_thresholdDb" min="-60" max="0"> <span id="noAEC_thresholdDb_val"></span>dB</label>
    <label>Gated: <span id="noAEC_gated">●</span></label>
  </details>
  <details>
    <summary>Time aligner config</summary>
    <label>Min Delay <input type="range" id="noAEC_taMinDelayMs" min="0" max="200"> <span id="noAEC_taMinDelayMs_val"></span>ms</label>
    <label>Update Interval <input type="range" id="noAEC_taUpdateIntervalFrames" min="100" max="5000" step="100"> <span id="noAEC_taUpdateIntervalFrames_val"></span> frames</label>
    <label>Echo Window <input type="range" id="noAEC_taEchoTimeWindowSizeMs" min="100" max="2000" step="50"> <span id="noAEC_taEchoTimeWindowSizeMs_val"></span>ms</label>
    <label>Step Size <input type="range" id="noAEC_taStepSize" min="1" max="200"> <span id="noAEC_taStepSize_val"></span> samples</label>
    <label>TX Threshold <input type="range" id="noAEC_taTxThresholdDb" min="-80" max="0"> <span id="noAEC_taTxThresholdDb_val"></span>dB</label>
    <label>RX Threshold <input type="range" id="noAEC_taRxThresholdDb" min="-80" max="0"> <span id="noAEC_taRxThresholdDb_val"></span>dB</label>
    <label>Smoothing α <input type="range" id="noAEC_taSmoothingAlpha" min="0.01" max="1" step="0.01"> <span id="noAEC_taSmoothingAlpha_val"></span></label>
    <label>NCC Threshold <input type="range" id="noAEC_taNccThreshold" min="0" max="1" step="0.05"> <span id="noAEC_taNccThreshold_val"></span></label>
    <label>XCorr Window <input type="range" id="noAEC_taXcorrWindowSize" min="512" max="4096" step="128"> <span id="noAEC_taXcorrWindowSize_val"></span> samples</label>
    <label>Echo Attenuation <input type="range" id="noAEC_taEchoAttenuation" min="0.01" max="1" step="0.01"> <span id="noAEC_taEchoAttenuation_val"></span></label>
    <label>Loop time locked: <span id="noAEC_taXcorrLock">●</span></label>
  </details>
  <details>
    <summary>Room impulse response config</summary>
    <label>IR Length/Echo time <input type="range" id="noAEC_rirIrLength" min="1024" max="32768" step="1024"> <span id="noAEC_rirIrLength_val"></span></label>
    <label>Measurement Duration <input type="range" id="noAEC_rirMeasurementDurationMs" min="500" max="5000" step="100"> <span id="noAEC_rirMeasurementDurationMs_val"></span>ms</label>
    <label>Test Signal Type <select id="noAEC_rirTestSignalType">
      <option value="dirac_sine">Dirac sine</option>
      <option value="dirac_square">Dirac square</option>
      <option value="mls">Maximum length sequence (whitenoiseish)</option>
    </select></label>
    <label>Dirac Pulse Width <input type="range" id="noAEC_rirDiracPulseWidth" min="1" max="128"> <span id="noAEC_rirDiracPulseWidth_val"></span> samples</label>
    <label>MLS Order <input type="range" id="noAEC_rirMlsOrder" min="10" max="16"> <span id="noAEC_rirMlsOrder_val"></span></label>
    <label>Echo Attenuation <input type="range" id="noAEC_rirEchoAttenuation" min="0.01" max="2" step="0.01"> <span id="noAEC_rirEchoAttenuation_val"></span></label>
  </details>
  <pre id="noAEC_stats" style="font-size: 60%; white-space: pre-wrap; word-break: break-all; max-width: 100%; overflow-wrap: break-word;"></pre>
  <audio id="noAEC_music" src="clips/music1.mp3" loop controls></audio>
  <audio id="noAEC_speech1" src="clips/speech1.mp3" loop controls></audio>
  <audio id="noAEC_speech2" src="clips/speech2.mp3" loop controls></audio>
  <audio id="noAEC_speech3" src="clips/speech3.wav" loop controls></audio>
  <hr/>
  <canvas id="noAEC_renderTd"></canvas>
  <canvas id="noAEC_micTd"></canvas>
</div>

</div>

<script src="extdeps/deps.js"></script>
<script type="module" src="js/app.js"></script>
</body>
</html>
